---
/**
 * Category Deep Dive Component
 * Detailed analysis of each risk category across companies
 */

import type { CrossCompanyMetrics } from '../../types/metrics';
import categoriesConfig from '../../config/categories.json';

interface Props {
  crossCompanyMetrics: CrossCompanyMetrics;
}

const { crossCompanyMetrics } = Astro.props;
---

<div class="space-y-6">
  {categoriesConfig.categories.map(category => {
    const categoryStats = crossCompanyMetrics.category_rankings?.find(
      c => c.category_name === category.name
    );

    if (!categoryStats) return null;

    return (
      <div class="relative overflow-hidden rounded-2xl border border-slate-700/60 bg-slate-950/60">
        <div
          class="absolute inset-y-0 left-0 w-1"
          style={`background: ${category.color}`}
          aria-hidden="true"
        ></div>

        <div class="px-6 sm:px-8 py-6 space-y-6">
          <!-- Category Header -->
          <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <div class="flex items-center gap-3 mb-3">
                <span class="text-3xl">{category.icon}</span>
                <h2 class="text-xl font-semibold text-slate-100 tracking-tight">
                  {category.name}
                </h2>
              </div>
              <p class="text-xs uppercase tracking-[0.25em] text-slate-500">
                Ranking #{categoryStats.ranking} across all categories
              </p>
            </div>

            <div class="grid grid-cols-2 gap-4 text-sm">
              <div class="rounded-xl border border-slate-700/60 bg-slate-900/70 px-4 py-3">
                <div class="text-[11px] uppercase tracking-[0.3em] text-slate-500 mb-1">Total snippets</div>
                <div class="text-xl font-semibold text-slate-100">{categoryStats.total_snippets}</div>
              </div>
              <div class="rounded-xl border border-slate-700/60 bg-slate-900/70 px-4 py-3">
                <div class="text-[11px] uppercase tracking-[0.3em] text-slate-500 mb-1">Avg evidence depth</div>
                <div class="text-xl font-semibold text-slate-100">{categoryStats.average_evidence_depth.toFixed(1)}</div>
              </div>
            </div>
          </div>

          <!-- Category Summary -->
          <div class="rounded-xl border border-slate-700/60 bg-slate-900/60 px-5 py-5 space-y-3 text-sm text-slate-300">
            <h3 class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">
              Category Summary
            </h3>
            <p>
              <span class="text-slate-400">Category focus:</span> {category.name}
            </p>
            <p>
              <span class="text-slate-400">Total evidence disclosures:</span> {categoryStats.total_snippets}
            </p>
            <p>
              <span class="text-slate-400">Average evidence depth:</span> {categoryStats.average_evidence_depth.toFixed(1)} snippets per question
            </p>
            <p>
              <span class="text-slate-400">Ranking:</span> #{categoryStats.ranking} across all categories
            </p>
          </div>
        </div>
      </div>
    );
  })}
</div>
