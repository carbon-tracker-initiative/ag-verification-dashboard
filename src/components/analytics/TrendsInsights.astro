---
/**
 * Trends and Insights Component
 * Key insights, patterns, and actionable recommendations
 */

import type { CrossCompanyMetrics } from '../../types/metrics';

interface Props {
  crossCompanyMetrics: CrossCompanyMetrics;
}

const { crossCompanyMetrics } = Astro.props;

// Generate insights based on data
const insights = [];

// Financial disclosure insight
if (crossCompanyMetrics.global_stats.average_financial_rate_all < 50) {
  insights.push({
    type: 'warning',
    icon: 'üí∞',
    title: 'Low Financial Quantification',
    message: `Only ${crossCompanyMetrics.global_stats.average_financial_rate_all.toFixed(0)}% of questions include financial amounts. Companies should prioritize quantifying risks in monetary terms.`,
    action: 'Recommend: Implement standardized financial impact assessment frameworks'
  });
} else {
  insights.push({
    type: 'success',
    icon: 'üí∞',
    title: 'Strong Financial Disclosure',
    message: `${crossCompanyMetrics.global_stats.average_financial_rate_all.toFixed(0)}% of questions include financial amounts, exceeding industry benchmarks.`,
    action: 'Maintain this high standard across all future reports'
  });
}

// Temporal specificity insight
const presentDayRate = crossCompanyMetrics.global_stats.average_temporal_present_day_rate_all;
if (presentDayRate > 70) {
  insights.push({
    type: 'warning',
    icon: 'üïê',
    title: 'Temporal Specificity Needs Improvement',
    message: `${presentDayRate.toFixed(0)}% of disclosures focus on present-day timeframes. Companies should balance with more forward-looking risk analysis.`,
    action: 'Recommend: Adopt temporal disclosure guidelines with emphasis on future-oriented risk assessment'
  });
}

// Evidence depth insight
const avgSnippets = crossCompanyMetrics.global_stats.total_snippets / crossCompanyMetrics.global_stats.total_questions;
if (avgSnippets < 2) {
  insights.push({
    type: 'info',
    icon: 'üìÑ',
    title: 'Limited Evidence Depth',
    message: `Average of ${avgSnippets.toFixed(1)} snippets per question. More comprehensive evidence would strengthen disclosure credibility.`,
    action: 'Recommend: Provide multiple sources and perspectives for each material risk'
  });
}

// No disclosure rate insight
const noDisclosureRate = (crossCompanyMetrics.global_stats.no_disclosure_count / crossCompanyMetrics.global_stats.total_questions) * 100;
if (noDisclosureRate > 20) {
  insights.push({
    type: 'critical',
    icon: '‚ö†Ô∏è',
    title: 'High No-Disclosure Rate',
    message: `${noDisclosureRate.toFixed(0)}% of questions have no disclosure. This represents significant gaps in transparency.`,
    action: 'Priority: Conduct materiality assessment to address disclosure gaps'
  });
}

// Best practices insight
const topCompany = crossCompanyMetrics.global_stats.best_company;
if (topCompany) {
  insights.push({
    type: 'success',
    icon: 'üèÜ',
    title: 'Industry Leader',
    message: `${topCompany.company_name} sets the benchmark with ${topCompany.total_snippets} evidence snippets across all questions.`,
    action: `Study ${topCompany.company_name}'s disclosure practices as a model for improvement`
  });
}
---

<div class="space-y-6">
  <!-- Key Insights -->
  <div class="bg-white rounded-lg shadow-sm p-6 border border-slate-200">
    <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
      <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
      </svg>
      Key Insights & Recommendations
    </h2>

    <div class="space-y-4">
      {insights.map(insight => {
        const bgColors = {
          success: 'bg-emerald-50',
          warning: 'bg-amber-50',
          info: 'bg-blue-50',
          critical: 'bg-red-50'
        };
        const borderColors = {
          success: 'border-emerald-200',
          warning: 'border-amber-200',
          info: 'border-blue-200',
          critical: 'border-red-200'
        };
        const textColors = {
          success: 'text-emerald-800',
          warning: 'text-amber-800',
          info: 'text-blue-800',
          critical: 'text-red-800'
        };

        return (
          <div class={`p-4 rounded-lg border-2 ${bgColors[insight.type]} ${borderColors[insight.type]}`}>
            <div class="flex items-start gap-3">
              <span class="text-2xl flex-shrink-0">{insight.icon}</span>
              <div class="flex-1">
                <h3 class={`text-sm font-bold mb-1 ${textColors[insight.type]}`}>
                  {insight.title}
                </h3>
                <p class="text-sm text-slate-700 mb-2">
                  {insight.message}
                </p>
                <div class={`text-xs font-semibold ${textColors[insight.type]} flex items-center gap-1`}>
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                  </svg>
                  <span>{insight.action}</span>
                </div>
              </div>
            </div>
          </div>
        );
      })}
    </div>
  </div>

  <!-- Industry Patterns -->
  <div class="bg-white rounded-lg shadow-sm p-6 border border-slate-200">
    <h2 class="text-xl font-bold text-slate-800 mb-4">Industry Patterns</h2>

    <div class="max-w-2xl">
      <!-- Classification Trends -->
      <div>
        <h3 class="text-sm font-semibold text-slate-700 mb-3">Classification Breakdown</h3>
        <div class="space-y-3">
          <div class="flex items-center justify-between p-3 bg-emerald-50 rounded border border-emerald-200">
            <span class="text-sm font-semibold text-emerald-800">Full Disclosure</span>
            <div class="text-right">
              <div class="text-lg font-bold text-emerald-600">
                {crossCompanyMetrics.global_stats.full_disclosure_count}
              </div>
              <div class="text-xs text-emerald-600">
                {((crossCompanyMetrics.global_stats.full_disclosure_count / crossCompanyMetrics.global_stats.total_questions) * 100).toFixed(0)}%
              </div>
            </div>
          </div>
          <div class="flex items-center justify-between p-3 bg-amber-50 rounded border border-amber-200">
            <span class="text-sm font-semibold text-amber-800">Partial</span>
            <div class="text-right">
              <div class="text-lg font-bold text-amber-600">
                {crossCompanyMetrics.global_stats.partial_disclosure_count}
              </div>
              <div class="text-xs text-amber-600">
                {((crossCompanyMetrics.global_stats.partial_disclosure_count / crossCompanyMetrics.global_stats.total_questions) * 100).toFixed(0)}%
              </div>
            </div>
          </div>
          <div class="flex items-center justify-between p-3 bg-slate-50 rounded border border-slate-200">
            <span class="text-sm font-semibold text-slate-800">Unclear</span>
            <div class="text-right">
              <div class="text-lg font-bold text-slate-600">
                {crossCompanyMetrics.global_stats.unclear_count}
              </div>
              <div class="text-xs text-slate-600">
                {((crossCompanyMetrics.global_stats.unclear_count / crossCompanyMetrics.global_stats.total_questions) * 100).toFixed(0)}%
              </div>
            </div>
          </div>
          <div class="flex items-center justify-between p-3 bg-red-50 rounded border border-red-200">
            <span class="text-sm font-semibold text-red-800">No Disclosure</span>
            <div class="text-right">
              <div class="text-lg font-bold text-red-600">
                {crossCompanyMetrics.global_stats.no_disclosure_count}
              </div>
              <div class="text-xs text-red-600">
                {((crossCompanyMetrics.global_stats.no_disclosure_count / crossCompanyMetrics.global_stats.total_questions) * 100).toFixed(0)}%
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Items -->
  <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6 border-2 border-blue-200">
    <h2 class="text-xl font-bold text-blue-900 mb-4 flex items-center gap-2">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
      </svg>
      Recommended Actions
    </h2>
    <ul class="space-y-3">
      <li class="flex items-start gap-3">
        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <div class="text-sm font-semibold text-blue-900">Enhance Financial Quantification</div>
          <div class="text-xs text-blue-800">Develop frameworks to quantify risk impacts in monetary terms across all material categories</div>
        </div>
      </li>
      <li class="flex items-start gap-3">
        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <div class="text-sm font-semibold text-blue-900">Improve Temporal Clarity</div>
          <div class="text-xs text-blue-800">Clearly label timeframes (current/future/historical) for all risk disclosures</div>
        </div>
      </li>
      <li class="flex items-start gap-3">
        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <div class="text-sm font-semibold text-blue-900">Balance Narrative Framing</div>
          <div class="text-xs text-blue-800">Present both risks and opportunities to demonstrate comprehensive risk management approach</div>
        </div>
      </li>
      <li class="flex items-start gap-3">
        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <div class="text-sm font-semibold text-blue-900">Benchmark Against Leaders</div>
          <div class="text-xs text-blue-800">Study disclosure practices of top performers to identify improvement opportunities</div>
        </div>
      </li>
    </ul>
  </div>
</div>
