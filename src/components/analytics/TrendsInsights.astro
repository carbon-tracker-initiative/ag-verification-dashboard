---
/**
 * Trends and Insights Component
 * Key insights, patterns, and actionable recommendations
 */

import type { CrossCompanyMetrics } from '../../types/metrics';

interface Props {
  crossCompanyMetrics: CrossCompanyMetrics;
}

const { crossCompanyMetrics } = Astro.props;

// Generate insights based on data
const insights = [];

// Financial disclosure insight
if (crossCompanyMetrics.global_stats.average_financial_rate_all < 50) {
  insights.push({
    type: 'warning',
    icon: '‚ö†Ô∏è',
    title: 'Low Financial Quantification',
    message: `Only ${crossCompanyMetrics.global_stats.average_financial_rate_all.toFixed(0)}% of questions include financial amounts. Companies should prioritize quantifying risks in monetary terms.`,
    action: 'Implement standardized financial impact assessment frameworks'
  });
} else {
  insights.push({
    type: 'success',
    icon: 'üåü',
    title: 'Strong Financial Disclosure',
    message: `${crossCompanyMetrics.global_stats.average_financial_rate_all.toFixed(0)}% of questions include financial amounts, exceeding industry benchmarks.`,
    action: 'Maintain this high standard across future disclosures'
  });
}

// Temporal specificity insight
const presentDayRate = crossCompanyMetrics.global_stats.average_temporal_present_day_rate_all ?? 0;
if (presentDayRate > 70) {
  insights.push({
    type: 'warning',
    icon: '‚è≥',
    title: 'Temporal Specificity Needs Balance',
    message: `${presentDayRate.toFixed(0)}% of disclosures focus on present-day timeframes. Companies should balance with more forward-looking risk analysis.`,
    action: 'Adopt temporal disclosure guidance that elevates future-oriented commitments'
  });
}

// Evidence depth insight
const avgSnippets = crossCompanyMetrics.global_stats.total_snippets / Math.max(crossCompanyMetrics.global_stats.total_questions, 1);
if (avgSnippets < 2) {
  insights.push({
    type: 'info',
    icon: 'üß≠',
    title: 'Limited Evidence Depth',
    message: `Average of ${avgSnippets.toFixed(1)} snippets per question. More comprehensive evidence would strengthen disclosure credibility.`,
    action: 'Provide multiple sources and perspectives for each material risk'
  });
}

// No disclosure rate insight
const noDisclosureRate = (crossCompanyMetrics.global_stats.no_disclosure_count / Math.max(crossCompanyMetrics.global_stats.total_questions, 1)) * 100;
if (noDisclosureRate > 20) {
  insights.push({
    type: 'critical',
    icon: 'üö®',
    title: 'High No-Disclosure Rate',
    message: `${noDisclosureRate.toFixed(0)}% of questions have no disclosure. This represents significant gaps in transparency.`,
    action: 'Conduct a focused materiality assessment to close disclosure gaps'
  });
}

// Best practices insight
const topCompany = crossCompanyMetrics.global_stats.best_company;
if (topCompany) {
  insights.push({
    type: 'success',
    icon: 'üèÜ',
    title: 'Industry Leader Spotlight',
    message: `${topCompany.company_name} sets the benchmark with ${topCompany.total_snippets} evidence disclosures across all questions.`,
    action: `Study ${topCompany.company_name}'s disclosure practices as a model for improvement`
  });
}

const toneStyles = {
  success: {
    border: 'border-emerald-400/40',
    accent: 'from-emerald-400/60 via-emerald-300/40 to-transparent',
    icon: 'bg-emerald-500/15 text-emerald-200',
    title: 'text-emerald-200',
    action: 'text-emerald-200'
  },
  warning: {
    border: 'border-amber-400/40',
    accent: 'from-amber-400/60 via-amber-300/40 to-transparent',
    icon: 'bg-amber-500/15 text-amber-200',
    title: 'text-amber-200',
    action: 'text-amber-200'
  },
  info: {
    border: 'border-sky-400/40',
    accent: 'from-sky-400/60 via-sky-300/40 to-transparent',
    icon: 'bg-sky-500/15 text-sky-200',
    title: 'text-sky-200',
    action: 'text-sky-200'
  },
  critical: {
    border: 'border-rose-400/40',
    accent: 'from-rose-500/60 via-rose-400/40 to-transparent',
    icon: 'bg-rose-500/15 text-rose-200',
    title: 'text-rose-200',
    action: 'text-rose-200'
  }
} as const;

const totalQuestions = Math.max(crossCompanyMetrics.global_stats.total_questions, 1);
const classificationCards = [
  {
    label: 'Full Disclosure',
    count: crossCompanyMetrics.global_stats.full_disclosure_count,
    percent: (crossCompanyMetrics.global_stats.full_disclosure_count / totalQuestions) * 100,
    border: 'border-emerald-400/35',
    text: 'text-emerald-200'
  },
  {
    label: 'Partial',
    count: crossCompanyMetrics.global_stats.partial_disclosure_count,
    percent: (crossCompanyMetrics.global_stats.partial_disclosure_count / totalQuestions) * 100,
    border: 'border-amber-400/35',
    text: 'text-amber-200'
  },
  {
    label: 'Unclear',
    count: crossCompanyMetrics.global_stats.unclear_count,
    percent: (crossCompanyMetrics.global_stats.unclear_count / totalQuestions) * 100,
    border: 'border-sky-400/25',
    text: 'text-sky-200'
  },
  {
    label: 'No Disclosure',
    count: crossCompanyMetrics.global_stats.no_disclosure_count,
    percent: (crossCompanyMetrics.global_stats.no_disclosure_count / totalQuestions) * 100,
    border: 'border-rose-400/35',
    text: 'text-rose-200'
  }
];

const actionItems = [
  {
    title: 'Enhance Financial Quantification',
    description: 'Develop frameworks to quantify risk impacts in monetary terms across all material categories.'
  },
  {
    title: 'Improve Temporal Clarity',
    description: 'Clearly anchor timeframes (present/future/historical) for every disclosure to strengthen comparability.'
  },
  {
    title: 'Balance Narrative Framing',
    description: 'Show both risks and opportunities to illustrate holistic risk management.'
  },
  {
    title: 'Benchmark Against Leaders',
    description: 'Reverse-engineer disclosure structures from the top-performing companies identified above.'
  }
];
---

<div class="space-y-8">
  <!-- Key Insights -->
  <div class="surface rounded-2xl border border-slate-700/60 p-6 sm:p-8">
    <div class="flex items-center gap-2 text-sky-300 mb-6">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
      </svg>
      <h2 class="text-xl font-semibold tracking-tight text-slate-100">
        Key Insights &amp; Recommendations
      </h2>
    </div>

    <div class="space-y-4">
      {insights.length === 0 ? (
        <div class="rounded-xl border border-slate-700 bg-slate-900/70 p-6 text-center text-slate-400">
          Insights will appear here once more disclosure data is available.
        </div>
      ) : (
        insights.map(insight => {
          const tone = toneStyles[insight.type as keyof typeof toneStyles];

          return (
            <div class={`relative overflow-hidden rounded-xl bg-slate-900/75 px-5 py-5 border ${tone.border}`}>
              <div class={`absolute inset-x-0 top-0 h-0.5 bg-gradient-to-r ${tone.accent}`}></div>

              <div class="flex items-start gap-4">
                <span
                  class={`flex h-12 w-12 items-center justify-center rounded-full text-xl ${tone.icon}`}
                  aria-hidden="true"
                >
                  {insight.icon}
                </span>
                <div class="flex-1 space-y-2">
                  <h3 class={`text-sm font-semibold tracking-wide uppercase ${tone.title}`}>
                    {insight.title}
                  </h3>
                  <p class="text-sm leading-relaxed text-slate-300">
                    {insight.message}
                  </p>
                  <div class={`flex items-center gap-2 text-xs font-semibold ${tone.action}`}>
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                    </svg>
                    <span>{insight.action}</span>
                  </div>
                </div>
              </div>
            </div>
          );
        })
      )}
    </div>
  </div>

  <!-- Industry Patterns -->
  <div class="surface rounded-2xl border border-slate-700/60 p-6 sm:p-8">
    <h2 class="text-xl font-semibold text-slate-100 mb-6">Industry Patterns</h2>

    <div class="space-y-6">
      <div>
        <h3 class="text-sm font-semibold uppercase tracking-[0.2em] text-slate-500 mb-4">
          Classification Breakdown
        </h3>
        <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
          {classificationCards.map(card => (
            <div class={`rounded-xl bg-slate-900/70 border ${card.border} px-4 py-5`}>
              <div class={`text-xs uppercase tracking-[0.25em] ${card.text} mb-3`}>
                {card.label}
              </div>
              <div class="flex items-end justify-between">
                <div class={`text-2xl font-semibold ${card.text}`}>
                  {card.count}
                </div>
                <div class="text-sm font-medium text-slate-300">
                  {card.percent.toFixed(0)}%
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>

  <!-- Action Items -->
  <div class="surface rounded-2xl border border-slate-700/60 bg-gradient-to-br from-slate-950/80 via-slate-900/70 to-slate-900/75 p-6 sm:p-8">
    <div class="flex items-center gap-2 text-sky-300 mb-5">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
      </svg>
      <h2 class="text-xl font-semibold text-slate-100">
        Recommended Actions
      </h2>
    </div>
    <ul class="space-y-4">
      {actionItems.map(item => (
        <li class="flex items-start gap-4 rounded-xl border border-slate-700/60 bg-slate-950/40 px-4 py-4">
          <span class="flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-sky-500/15 text-sky-200">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </span>
          <div class="space-y-1">
            <div class="text-sm font-semibold text-slate-100">{item.title}</div>
            <div class="text-xs leading-relaxed text-slate-400">
              {item.description}
            </div>
          </div>
        </li>
      ))}
    </ul>
  </div>
</div>
