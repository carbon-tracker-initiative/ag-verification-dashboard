---
/**
 * Company card for home page
 * Shows company summary with link to detail page
 */

import type { CompanyMetrics } from '../../types/metrics';
import GradeDisplay from '../shared/GradeDisplay.astro';
import VersionBadge from '../VersionBadge.astro';
import { formatNumber, formatPercentage } from '../../utils/formatters';

interface Props {
  company: CompanyMetrics;
  version: string;
  year: number;
  companyName: string;
}

const { company, version, year, companyName } = Astro.props;

// Determine if this is the latest version (v4 > v3, etc.)
const versionNum = parseInt(version.replace('v', ''));
const isLatest = versionNum >= 4; // Simple heuristic - can be improved
---

<div class="surface flex flex-col h-full p-6 transition-transform duration-200 hover:-translate-y-1">
  <div class="flex items-start justify-between mb-5">
    <div>
      <div class="flex items-center gap-2 mb-1">
        <h3 class="text-lg font-semibold text-slate-100">{company.company_name}</h3>
        <VersionBadge version={version} isLatest={isLatest} size="sm" />
      </div>
      <p class="text-sm text-slate-400">Calendar Year {company.fiscal_year}</p>
    </div>
    <GradeDisplay score={company.overall_disclosure_score} showGrade={true} showScore={true} size="md" />
  </div>

  <div class="space-y-3 mb-5">
    <div class="flex items-center gap-2">
      <span class="text-xs text-slate-500 w-24 uppercase tracking-wide">Quality</span>
      <div class="flex-1 bg-slate-900 rounded-full h-2">
        <div
          class="bg-emerald-400 h-2 rounded-full transition-all"
          style={`width: ${company.radar_metrics.disclosure_quality}%`}
        ></div>
      </div>
      <span class="text-xs font-semibold text-slate-200 w-12 text-right">
        {formatPercentage(company.radar_metrics.disclosure_quality, 0)}
      </span>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-xs text-slate-500 w-24 uppercase tracking-wide">Evidence</span>
      <div class="flex-1 bg-slate-900 rounded-full h-2">
        <div
          class="bg-sky-400 h-2 rounded-full transition-all"
          style={`width: ${company.radar_metrics.evidence_depth}%`}
        ></div>
      </div>
      <span class="text-xs font-semibold text-slate-200 w-12 text-right">
        {formatPercentage(company.radar_metrics.evidence_depth, 0)}
      </span>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-xs text-slate-500 w-24 uppercase tracking-wide">Financial</span>
      <div class="flex-1 bg-slate-900 rounded-full h-2">
        <div
          class="bg-purple-400 h-2 rounded-full transition-all"
          style={`width: ${company.radar_metrics.financial_transparency}%`}
        ></div>
      </div>
      <span class="text-xs font-semibold text-slate-200 w-12 text-right">
        {formatPercentage(company.radar_metrics.financial_transparency, 0)}
      </span>
    </div>
  </div>

  <div class="grid grid-cols-3 gap-3 text-center mb-6">
    <div>
      <div class="text-lg font-semibold text-slate-100">
        {company.snippets_by_classification.FULL_DISCLOSURE}
      </div>
      <div class="text-[11px] uppercase tracking-wide text-slate-500">Full</div>
    </div>
    <div>
      <div class="text-lg font-semibold text-slate-100">
        {formatNumber(company.total_snippets)}
      </div>
      <div class="text-[11px] uppercase tracking-wide text-slate-500">Snippets</div>
    </div>
    <div>
      <div class="text-lg font-semibold text-slate-100">
        {formatPercentage(company.financial_quantification_rate, 0)}
      </div>
      <div class="text-[11px] uppercase tracking-wide text-slate-500">Financial</div>
    </div>
  </div>

  <a
    href={`${import.meta.env.BASE_URL}/${companyName.toLowerCase()}/${year}/${version}`}
    class="mt-auto inline-flex items-center justify-center gap-2 rounded-md border border-slate-600 px-4 py-2 text-sm font-semibold text-slate-200 transition-colors hover:border-slate-400 hover:text-slate-50"
  >
    View Analysis
    <span aria-hidden="true">â†’</span>
  </a>
</div>
