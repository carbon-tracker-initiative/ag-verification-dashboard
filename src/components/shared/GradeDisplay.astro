---
/**
 * Grade display component
 * Shows letter grade and/or numeric score
 */

import type { Grade } from '../../types/metrics';

interface Props {
  score: number; // 0-100
  grade?: Grade; // Optional pre-calculated grade
  showGrade?: boolean;
  showScore?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

const { score, grade: providedGrade, showGrade = true, showScore = true, size = 'md' } = Astro.props;

// Calculate grade if not provided
function calculateGrade(score: number): Grade {
  if (score >= 90) return "A";
  if (score >= 80) return "B";
  if (score >= 70) return "C";
  if (score >= 60) return "D";
  return "F";
}

const grade = providedGrade || calculateGrade(score);

// Grade descriptions for accessibility
const gradeDescriptions: Record<Grade, string> = {
  'A': 'Excellent (90-100%)',
  'B': 'Good (80-89%)',
  'C': 'Fair (70-79%)',
  'D': 'Poor (60-69%)',
  'F': 'Failing (below 60%)'
};

// Color scheme by grade
const colors: Record<Grade, { bg: string; text: string; border: string }> = {
  'A': {
    bg: 'bg-green-100',
    text: 'text-green-800',
    border: 'border-green-300'
  },
  'B': {
    bg: 'bg-blue-100',
    text: 'text-blue-800',
    border: 'border-blue-300'
  },
  'C': {
    bg: 'bg-yellow-100',
    text: 'text-yellow-800',
    border: 'border-yellow-300'
  },
  'D': {
    bg: 'bg-orange-100',
    text: 'text-orange-800',
    border: 'border-orange-300'
  },
  'F': {
    bg: 'bg-red-100',
    text: 'text-red-800',
    border: 'border-red-300'
  }
};

// Size classes
const sizeClasses = {
  sm: 'text-xs px-2 py-0.5',
  md: 'text-sm px-2.5 py-1',
  lg: 'text-base px-3 py-1.5'
};

const colorScheme = colors[grade];
---

<span
  class:list={[
    'inline-flex items-center gap-1.5 rounded-md font-semibold border transition-all duration-200',
    colorScheme.bg,
    colorScheme.text,
    colorScheme.border,
    sizeClasses[size]
  ]}
  role="status"
  aria-label={`Grade: ${gradeDescriptions[grade]} - Score: ${score.toFixed(1)}%`}
  title={`Grade: ${gradeDescriptions[grade]} - Score: ${score.toFixed(1)}%`}
>
  {showGrade && <span class="font-bold text-lg" aria-hidden="true">{grade}</span>}
  {showScore && <span aria-hidden="true">{score.toFixed(1)}%</span>}
</span>

<style>
  /* Ensure grade letter is prominent */
  span.font-bold.text-lg {
    line-height: 1;
  }
</style>
