---
/**
 * Grade display component
 * Shows letter grade and/or numeric score
 */

import type { Grade } from '../../types/metrics';

interface Props {
  score: number;
  grade?: Grade;
  showGrade?: boolean;
  showScore?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

const { score, grade: providedGrade, showGrade = true, showScore = true, size = 'md' } = Astro.props;

function calculateGrade(score: number): Grade {
  if (score >= 90) return "A";
  if (score >= 80) return "B";
  if (score >= 70) return "C";
  if (score >= 60) return "D";
  return "F";
}

const grade = providedGrade || calculateGrade(score);

const gradeDescriptions: Record<Grade, string> = {
  'A': 'Excellent (90-100%)',
  'B': 'Good (80-89%)',
  'C': 'Fair (70-79%)',
  'D': 'Poor (60-69%)',
  'F': 'Failing (below 60%)'
};

const colors: Record<Grade, string> = {
  'A': 'bg-emerald-500/15 text-emerald-200 border border-emerald-400/30',
  'B': 'bg-sky-500/15 text-sky-200 border border-sky-400/30',
  'C': 'bg-amber-500/15 text-amber-200 border border-amber-400/30',
  'D': 'bg-orange-500/15 text-orange-200 border border-orange-400/30',
  'F': 'bg-rose-500/20 text-rose-200 border border-rose-400/40'
};

const containerSize: Record<typeof size, string> = {
  sm: 'px-2 py-0.5 text-[11px]',
  md: 'px-2.5 py-1 text-xs',
  lg: 'px-3 py-1.5 text-sm'
};

const gradeSize: Record<typeof size, string> = {
  sm: 'text-sm',
  md: 'text-base',
  lg: 'text-lg'
};
---

<span
  class:list={[
    'inline-flex items-center gap-1.5 rounded-md font-semibold transition-all duration-200',
    colors[grade],
    containerSize[size]
  ]}
  role="status"
  aria-label={`Grade: ${gradeDescriptions[grade]} - Score: ${score.toFixed(1)}%`}
  title={`Grade: ${gradeDescriptions[grade]} - Score: ${score.toFixed(1)}%`}
>
  {showGrade && (
    <span class={`font-bold leading-none ${gradeSize[size]}`} aria-hidden="true">
      {grade}
    </span>
  )}
  {showScore && <span class="leading-none" aria-hidden="true">{score.toFixed(1)}%</span>}
</span>
